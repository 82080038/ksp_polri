<!DOCTYPE html>
<html>

<head>
    <title>Aset Tetap - KSP POLRI</title>
    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; connect-src 'self' https://cdn.jsdelivr.net; img-src 'self' data:">
    <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>
    <h2>Aset Tetap</h2>
    <a href="dashboard_pengurus.html">Kembali ke Dashboard</a>

    <h3>Tambah Aset Tetap</h3>
    <form id="assetForm">
        <input type="text" name="kode_aset" placeholder="Kode Aset" required><br>
        <input type="text" name="nama_aset" placeholder="Nama Aset" required><br>
        <input type="text" name="kategori" placeholder="Kategori" required><br>
        <input type="number" name="nilai_perolehan" placeholder="Nilai Perolehan" step="0.01" required><br>
        <input type="date" name="tanggal_perolehan" required><br>
        <select name="metode_depresiasi" required>
            <option value="">Pilih Metode Depresiasi</option>
            <option value="STRAIGHT_LINE">Garis Lurus (Straight Line)</option>
        </select><br>
        <input type="number" name="umur_ekonomis" placeholder="Umur Ekonomis (tahun)" required><br>
        <button type="submit">Simpan</button>
    </form>

    <h3>Daftar Aset Tetap</h3>
    <div id="assetList"></div>

    <script src="../assets/js/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            loadAssets();

            $('#assetForm').on('submit', function (e) {
                e.preventDefault();
                $.post('../../backend/public/index.php?path=accounting/asset/create', $(this).serialize(), function (data) {
                    alert(data.message);
                    if (data.status) {
                        $('#assetForm')[0].reset();
                        loadAssets();
                    }
                }, 'json');
            });

            function loadAssets() {
                $.get('../../backend/public/index.php?path=accounting/asset/list', function (data) {
                    if (data.status) {
                        let html = '<table border="1"><tr><th>Kode</th><th>Nama</th><th>Kategori</th><th>Nilai Perolehan</th><th>Tanggal</th><th>Nilai Buku</th><th>Status</th><th>Aksi</th></tr>';
                        data.data.forEach(a => {
                            html += `<tr><td>${a.kode_aset}</td><td>${a.nama_aset}</td><td>${a.kategori}</td><td>${formatRupiah(a.nilai_perolehan)}</td><td>${a.tanggal_perolehan}</td><td>${formatRupiah(a.nilai_buku)}</td><td>${a.status}</td><td><button onclick="viewDepreciation(${a.id})">Depresiasi</button></td></tr>`;
                        });
                        html += '</table>';
                        $('#assetList').html(html);
                    }
                }, 'json');
            }

            window.viewDepreciation = function (id) {
                $.get('../../backend/public/index.php?path=accounting/asset/calculateDepreciation&id=' + id, function (data) {
                    if (data.status) {
                        let html = '<h4>Jadwal Depresiasi</h4><table border="1"><tr><th>Tahun</th><th>Depresiasi</th><th>Nilai Buku</th></tr>';
                        data.data.forEach(d => {
                            html += `<tr><td>${d.periode}</td><td>${formatRupiah(d.nilai_depresiasi)}</td><td>${formatRupiah(d.nilai_buku_setelah)}</td></tr>`;
                        });
                        html += '</table>';
                        html += `<button onclick="saveDepreciation(${id})">Simpan Depresiasi</button>`;
                        alert(html);
                    }
                }, 'json');
            };

            window.saveDepreciation = function (id) {
                $.post('../../backend/public/index.php?path=accounting/asset/saveDepreciation', { id: id }, function (data) {
                    alert(data.message);
                }, 'json');
            };

            function formatRupiah(angka) {
                return 'Rp ' + parseFloat(angka).toLocaleString('id-ID');
            }
        });
    </script>
</body>

</html>