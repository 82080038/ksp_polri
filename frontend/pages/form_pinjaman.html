<!DOCTYPE html>
<html>

<head>
    <title>Ajukan Pinjaman</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>

<body>
    <h2>Ajukan Pinjaman</h2>
    <form id="pinjamanForm">
        <label>Anggota ID</label><br>
        <input type="number" name="anggota_id" min="1" required><br>

        <label>Jumlah (Rp)</label><br>
        <input type="number" name="jumlah" min="500000" step="50000" required><small> Min Rp500.000</small><br>

        <label>Tenor (bulan)</label><br>
        <input type="number" name="tenor" min="1" max="60" required><small> 1-60 bulan</small><br>

        <label>Bunga (%) per tahun</label><br>
        <input type="number" step="0.01" name="bunga" min="0" max="30" required><small> Maks 30%</small><br><br>

        <button type="submit" id="submitBtn">Ajukan</button>
    </form>
    <div id="message"></div>
    <script src="../assets/js/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#pinjamanForm').on('submit', function (e) {
                e.preventDefault();
                const btn = $('#submitBtn');
                btn.prop('disabled', true).text('Memproses...');
                $('#message').text('');

                const jumlah = parseFloat($('input[name="jumlah"]').val() || 0);
                const tenor = parseInt($('input[name="tenor"]').val() || 0);
                const bunga = parseFloat($('input[name="bunga"]').val() || 0);

                if (jumlah < 500000 || tenor < 1 || tenor > 60 || bunga < 0 || bunga > 30) {
                    $('#message').text('Validasi gagal: periksa batas jumlah/tenor/bunga.');
                    btn.prop('disabled', false).text('Ajukan');
                    return;
                }

                $.post('../backend/public/index.php?path=pinjaman/create', $(this).serialize(), function (data) {
                    $('#message').text(data.message || 'Terjadi kesalahan');
                    if (data.status) {
                        $('#pinjamanForm')[0].reset();
                    }
                }, 'json').fail(function () {
                    $('#message').text('Gagal mengirim permintaan.');
                }).always(function () {
                    btn.prop('disabled', false).text('Ajukan');
                });
            });
        });
    </script>
</body>

</html>